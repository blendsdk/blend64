module Demos.CallbackPatterns

// Pattern 1: Simple callback for interrupts
callback function simpleRaster(): void
    setBackgroundColor(RED)
end function

// Pattern 2: Callback with parameters for AI
callback function aiWithParams(aggression: byte): void
    if aggression > 5 then
        attackPlayer()
    else
        avoidPlayer()
    end if
end function

// Pattern 3: Callback with return value for getters
callback function getRandomValue(): byte
    return random(255)
end function

// Pattern 4: Callback calling multiple functions
callback function complexHandler(): void
    updatePlayerSprite()
    updateEnemySprites()
    updateBackgroundAnimation()
    checkHardwareCollisions()
end function

// Pattern 5: Callback with loop processing
callback function batchProcessor(): void
    for i = 0 to activeEnemyCount - 1
        if enemies[i].active then
            updateEnemySprite(i)
        end if
    next i
end function

export function demonstratePatterns(): void
    // Hardware interrupt usage
    setRasterInterrupt(100, simpleRaster)

    // AI system usage
    var aiHandlers: callback[1] = [aiWithParams]
    setEnemyAI(0, aiHandlers[0])

    // Menu system usage
    setMenuAction(0, complexHandler)

    // Custom callback execution
    var getter: callback = getRandomValue
    var randomValue: byte = getter()

    // Complex patterns
    setupBatchProcessor()
end function
