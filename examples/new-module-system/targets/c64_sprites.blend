module c64.sprites

// C64-specific sprite implementation
// This would be resolved when compiling with --target=c64
// target.sprites -> c64.sprites

// VIC-II Register definitions
const VIC_SPRITE_ENABLE: word = $D015
const VIC_SPRITE0_X: word = $D000
const VIC_SPRITE0_Y: word = $D001
const VIC_SPRITE_X_MSB: word = $D010
const VIC_SPRITE0_COLOR: word = $D027

export function setSpritePosition(sprite: byte, x: word, y: byte): void
    // Set sprite Y coordinate
    var spriteYReg: word = VIC_SPRITE0_Y + (sprite * 2)
    poke(spriteYReg, y)

    // Set sprite X coordinate (low byte)
    var spriteXReg: word = VIC_SPRITE0_X + (sprite * 2)
    poke(spriteXReg, x and $FF)

    // Set X MSB if needed
    var currentMSB: byte = peek(VIC_SPRITE_X_MSB)
    var spriteMask: byte = 1 << sprite

    if (x and $0100) > 0 then
        // Set MSB
        poke(VIC_SPRITE_X_MSB, currentMSB or spriteMask)
    else
        // Clear MSB
        poke(VIC_SPRITE_X_MSB, currentMSB and (255 - spriteMask))
    end if
end function

export function setSpriteColor(sprite: byte, color: byte): void
    var colorReg: word = VIC_SPRITE0_COLOR + sprite
    poke(colorReg, color)
end function

export function enableSprite(sprite: byte): void
    var currentEnable: byte = peek(VIC_SPRITE_ENABLE)
    var spriteMask: byte = 1 << sprite
    poke(VIC_SPRITE_ENABLE, currentEnable or spriteMask)
end function

export function disableSprite(sprite: byte): void
    var currentEnable: byte = peek(VIC_SPRITE_ENABLE)
    var spriteMask: byte = 1 << sprite
    poke(VIC_SPRITE_ENABLE, currentEnable and (255 - spriteMask))
end function

// Internal peek/poke functions (would be provided by target.memory)
function peek(address: word): byte
    // Implementation would be target-specific inline assembly
end function

function poke(address: word, value: byte): void
    // Implementation would be target-specific inline assembly
end function
